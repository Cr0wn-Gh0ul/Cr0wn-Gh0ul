<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troy Salem Blog</title>
    <meta name="description" content="Troy Salem Blog">
    <meta name="author" content="Troy Salem">
    
    <link rel="icon" type="image/png" href="/Cr0wn-Gh0ul/img/ghost-crown.png">
    
    <meta property="og:title" content="PhaseState: Minimal State Machine" />
    <meta property="og:description" content="Troy Salem Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://cr0wn-gh0ul.github.io/Cr0wn-Gh0ul/posts/2025-12-16/" />
    <meta property="og:image" content="/Cr0wn-Gh0ul/img/ghost-crown.png" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="PhaseState: Minimal State Machine" />
    <meta name="twitter:description" content="Troy Salem Blog" />
    <meta name="twitter:image" content="/Cr0wn-Gh0ul/img/ghost-crown.png" />
    <link rel="stylesheet" href="/Cr0wn-Gh0ul/css/style.css">
    
</head>
<body class="">
    <header class="site-header">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=JetBrains+Mono:wght@600&display=swap"
        rel="stylesheet">
    <nav class="site-nav">
        <a href="/" class="site-title">Troy Salem Blog</a>
        <ul class="nav-menu">
            
            <li>
                
                
                <a href="/Cr0wn-Gh0ul/" >
                    ./home
                    
                </a>
            </li>
            
            <li>
                
                
                <a href="/Cr0wn-Gh0ul/posts/" >
                    ./posts
                    
                </a>
            </li>
            
            <li>
                
                
                <a href="https://troysalem.com/" >
                    ./website
                    
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor"
                        style="width:1em;height:1em;vertical-align:baseline;position:relative;top:0.13em;margin-left:-0.3em;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                    
                </a>
            </li>
            
        </ul>
    </nav>
</header>
    <div id="content-wrapper" class="site-wrapper">
        <main>
            
<article class="single-post">
    <header>
        <h1>PhaseState: Minimal State Machine</h1>
        <div class="post-meta">
            December 16, 2025
             · T. Salem
             · 4 min read
        </div>
        
        <div class="tags">
            
            
            <a href="/Cr0wn-Gh0ul/tags/code/">#code</a>
            
            
            <a href="/Cr0wn-Gh0ul/tags/programming/">#programming</a>
            
            </div>  
        
    </header>
    
    <div class="content">
        <p>State machines are one of those patterns that sound academic until you actually need one.
<br></br></p>
<p>A form wizard with validation between steps. A connection that can be connecting, connected, disconnecting, or error. A game character that can be idle, walking, jumping, or dead, and dead should not transition to jumping.
<br></br></p>
<p>Every time I reach for a state machine library, I end up fighting it. Too much boilerplate, weird DSL, or a 50KB bundle for something that should be simple.
<br></br></p>
<p>So I built <a href="https://github.com/Cr0wn-Gh0ul/PhaseState">PhaseState</a>.
<br></br></p>
<hr>
<h2 id="what-it-looks-like">What it looks like</h2>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> { machine } <span style="color:#ff7b72">from</span> <span style="color:#a5d6ff">&#39;phasestate&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">const</span> loader <span style="color:#ff7b72;font-weight:bold">=</span> machine(<span style="color:#a5d6ff">&#34;idle&#34;</span>, { count: <span style="color:#ff7b72">0</span> })
</span></span><span style="display:flex;"><span>  .when(<span style="color:#a5d6ff">&#34;idle&#34;</span>, {
</span></span><span style="display:flex;"><span>    enter<span style="color:#ff7b72;font-weight:bold">:</span> () <span style="color:#ff7b72;font-weight:bold">=&gt;</span> console.log(<span style="color:#a5d6ff">&#34;Ready&#34;</span>),
</span></span><span style="display:flex;"><span>    to<span style="color:#ff7b72;font-weight:bold">:</span> [<span style="color:#a5d6ff">&#34;loading&#34;</span>]
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .when(<span style="color:#a5d6ff">&#34;loading&#34;</span>, {
</span></span><span style="display:flex;"><span>    enter: <span style="color:#ff7b72">async</span> () <span style="color:#ff7b72;font-weight:bold">=&gt;</span> {
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">&#34;Fetching...&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#ff7b72">await</span> fetchData();
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">from</span><span style="color:#ff7b72;font-weight:bold">:</span> [<span style="color:#a5d6ff">&#34;idle&#34;</span>],
</span></span><span style="display:flex;"><span>    to<span style="color:#ff7b72;font-weight:bold">:</span> [<span style="color:#a5d6ff">&#34;success&#34;</span>, <span style="color:#a5d6ff">&#34;error&#34;</span>]
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .when(<span style="color:#a5d6ff">&#34;success&#34;</span>, {
</span></span><span style="display:flex;"><span>    enter<span style="color:#ff7b72;font-weight:bold">:</span> (ctx) <span style="color:#ff7b72;font-weight:bold">=&gt;</span> console.log(<span style="color:#a5d6ff">&#34;Done!&#34;</span>, ctx.count),
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">from</span><span style="color:#ff7b72;font-weight:bold">:</span> [<span style="color:#a5d6ff">&#34;loading&#34;</span>]
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .when(<span style="color:#a5d6ff">&#34;error&#34;</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">from</span><span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>    to<span style="color:#ff7b72;font-weight:bold">:</span> [<span style="color:#a5d6ff">&#34;idle&#34;</span>]
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">await</span> loader.to(<span style="color:#a5d6ff">&#34;loading&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>Define states with <code>.when()</code>. Transition with <code>.to()</code>. The <code>from</code> and <code>to</code> constraints say which transitions are allowed. That is mostly it.
<br></br></p>
<div class="mermaid">
  flowchart LR
  A[".to(state)"] --> B{from/to valid?}
  B -->|No| C[Blocked]
  B -->|Yes| D{Guards pass?}
  D -->|No| C
  D -->|Yes| E["exit()"]
  E --> F[Update State]
  F --> G["enter()"]
  G --> H[Done]
</div>
<p><br></br></p>
<hr>
<h2 id="guards">Guards</h2>
<p>Sometimes a transition depends on more than just the current state.
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>loader.can(<span style="color:#a5d6ff">&#34;loading&#34;</span>, state <span style="color:#ff7b72;font-weight:bold">=&gt;</span> state.context.count <span style="color:#ff7b72;font-weight:bold">&lt;</span> <span style="color:#a5d6ff">100</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>Now <code>.to(&quot;loading&quot;)</code> only works if <code>count &lt; 100</code>. Guards stack. If any guard returns false, the transition is blocked.
<br></br></p>
<p>You can check what transitions are currently valid:</p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>loader.transitions(); <span style="color:#8b949e;font-style:italic">// [&#39;loading&#39;] or [] depending on guards
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<hr>
<h2 id="async-everything">Async everything</h2>
<p>Enter and exit handlers can be async. Transitions wait for them.
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span>.when(<span style="color:#a5d6ff">&#34;loading&#34;</span>, {
</span></span><span style="display:flex;"><span>  enter: <span style="color:#ff7b72">async</span> (ctx) <span style="color:#ff7b72;font-weight:bold">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">const</span> data <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#ff7b72">await</span> fetchData();
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic">// do something with data
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>  },
</span></span><span style="display:flex;"><span>  exit: <span style="color:#ff7b72">async</span> () <span style="color:#ff7b72;font-weight:bold">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">await</span> cleanup();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>This is the thing I always had to hack around in other libraries. Here it just works.
<br></br></p>
<hr>
<h2 id="context">Context</h2>
<p>State machines often need to carry data. That is what context is for.
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff7b72">const</span> form <span style="color:#ff7b72;font-weight:bold">=</span> machine(<span style="color:#a5d6ff">&#34;step1&#34;</span>, { 
</span></span><span style="display:flex;"><span>  email<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span>  password<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;&#34;</span>, 
</span></span><span style="display:flex;"><span>  isValid: <span style="color:#ff7b72">false</span> 
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Update context without changing state
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>form.<span style="color:#ff7b72">set</span>({ email<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;user@example.com&#34;</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Update context during transition
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">await</span> form.to(<span style="color:#a5d6ff">&#34;step2&#34;</span>, { isValid: <span style="color:#ff7b72">true</span> });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Or with a function
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">await</span> form.to(<span style="color:#a5d6ff">&#34;step2&#34;</span>, ctx <span style="color:#ff7b72;font-weight:bold">=&gt;</span> ({ ...ctx, step: <span style="color:#ff7b72">2</span> }));
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>TypeScript infers the context shape. Try to set a field that does not exist and you get a compile error.
<br></br></p>
<hr>
<h2 id="snapshots-and-history">Snapshots and history</h2>
<p>Sometimes you need to save and restore state. Or go back.
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Snapshot current state
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">const</span> snapshot <span style="color:#ff7b72;font-weight:bold">=</span> form.snapshot();
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// { state: &#39;step2&#39;, context: { email: &#39;...&#39;, ... } }
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Later, restore it
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>form.restore(snapshot);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic">// Or just go back one step
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span><span style="color:#ff7b72">await</span> form.back();
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>History is capped at 10 states by default. Enough for undo, not enough to leak memory.
<br></br></p>
<hr>
<h2 id="sequences">Sequences</h2>
<p>For scripted flows, you can run a sequence of transitions:
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff7b72">await</span> loader.run([
</span></span><span style="display:flex;"><span>  { to<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;loading&#34;</span> },
</span></span><span style="display:flex;"><span>  { to<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;success&#34;</span>, delay: <span style="color:#ff7b72">1000</span> },
</span></span><span style="display:flex;"><span>  { to<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;idle&#34;</span>, update<span style="color:#ff7b72;font-weight:bold">:</span> { count: <span style="color:#ff7b72">0</span> } }
</span></span><span style="display:flex;"><span>]);
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>Each step can have a delay. Useful for animations, testing, or anything with timing.
<br></br></p>
<p>Or use the generator for step-by-step control:</p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff7b72">const</span> steps <span style="color:#ff7b72;font-weight:bold">=</span> loader.steps();
</span></span><span style="display:flex;"><span>steps.next(); <span style="color:#8b949e;font-style:italic">// initial state
</span></span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"></span>steps.next({ to<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;loading&#34;</span> });
</span></span><span style="display:flex;"><span>steps.next({ to<span style="color:#ff7b72;font-weight:bold">:</span> <span style="color:#a5d6ff">&#34;success&#34;</span> });
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<hr>
<h2 id="events">Events</h2>
<p>Subscribe to transitions:
<br></br></p>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ts" data-lang="ts"><span style="display:flex;"><span><span style="color:#ff7b72">const</span> unsubscribe <span style="color:#ff7b72;font-weight:bold">=</span> loader.on(event <span style="color:#ff7b72;font-weight:bold">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#ff7b72">if</span> (<span style="color:#a5d6ff">&#39;type&#39;</span> <span style="color:#ff7b72">in</span> event <span style="color:#ff7b72;font-weight:bold">&amp;&amp;</span> event.<span style="color:#ff7b72">type</span> <span style="color:#ff7b72;font-weight:bold">===</span> <span style="color:#a5d6ff">&#39;transition&#39;</span>) {
</span></span><span style="display:flex;"><span>    console.log(<span style="color:#a5d6ff">`</span><span style="color:#a5d6ff">${</span>event.<span style="color:#ff7b72">from</span><span style="color:#a5d6ff">}</span><span style="color:#a5d6ff"> → </span><span style="color:#a5d6ff">${</span>event.to<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">if</span> (event.blocked) {
</span></span><span style="display:flex;"><span>      console.log(<span style="color:#a5d6ff">`Blocked by: </span><span style="color:#a5d6ff">${</span>event.blocked<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></td></tr></table>
</div>
</div><p><br></br></p>
<p>You get both successful transitions and blocked attempts. Good for debugging, logging, or wiring up side effects.
<br></br></p>
<hr>
<h2 id="what-i-actually-use-it-for">What I actually use it for</h2>
<p><strong>Form wizards.</strong> Multi-step forms where you cannot skip ahead, can go back, and need to validate between steps.
<br></br></p>
<p><strong>Connection states.</strong> WebSocket or API connections with proper handling of connecting, reconnecting, disconnected, error.
<br></br></p>
<p><strong>UI modes.</strong> Modal open/closed, drawer expanded/collapsed, but with rules about what can trigger what.
<br></br></p>
<p><strong>Game logic.</strong> Player states, enemy AI, anything where &quot;what can happen next&quot; depends on &quot;what is happening now&quot;.
<br></br></p>
<hr>
<h2 id="the-tradeoffs">The tradeoffs</h2>
<p>Zero dependencies. Tiny bundle. Works in Node and browsers.
<br></br></p>
<p>It is not trying to be XState. No visualizers, no actors, no parallel states. If you need those, use XState. If you need a state machine without the ceremony, this is the one I reach for.
<br></br></p>
<hr>
<h2 id="links">Links</h2>
<p>PhaseState: <a href="https://github.com/Cr0wn-Gh0ul/PhaseState">https://github.com/Cr0wn-Gh0ul/PhaseState</a><br>
npm: <a href="https://www.npmjs.com/package/phasestate">https://www.npmjs.com/package/phasestate</a></p>

    </div>
    
    
    <nav class="post-navigation" style="display: flex; justify-content: space-between; gap: 2em; margin-top: 2em;">
        <div class="nav-prev">
            
            ← <a href="https://cr0wn-gh0ul.github.io/Cr0wn-Gh0ul/posts/2025-12-01/">C64: Lost Signal</a>
            
        </div>
        <div class="nav-next" style="margin-left:auto;">
            
            <a href="https://cr0wn-gh0ul.github.io/Cr0wn-Gh0ul/posts/2025-12-17/">My Career Journey ... So Far</a> →
            
        </div>
    </nav>
    
</article>

        </main>
        
    </div>
    <footer class="site-footer"
  style="flex-shrink:0;left:0;right:0;margin:0 auto;padding:0;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono','SF Mono','Fira Code','Consolas',monospace;font-size:12px;color:#8a8a9c;height:44px;text-align:center;z-index:1000;width:100%;background:none;box-shadow:none;position:relative;">
  <a href="#" id="scrollTop"
    style="margin-left:16px;margin-right:auto;display:flex;align-items:center;justify-content:center;width:40px;height:40px;font-size:18px;color:#4ade5e;text-decoration:none;opacity:.6;transition:opacity 0.2s;cursor:pointer;flex-shrink:0;">↑</a>
  <p style="width:100%;text-align:center;margin:0;">© 2026 Cr0wn_Gh0ul</p>
  <script>
    
    document.addEventListener('DOMContentLoaded', function () {
      const scrollTop = document.getElementById('scrollTop');
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          scrollTop.style.opacity = '1';
          scrollTop.style.pointerEvents = 'auto';
        } else {
          scrollTop.style.opacity = '0.6';
          scrollTop.style.pointerEvents = 'auto';
        }
      });
      scrollTop.addEventListener('click', (e) => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });
  </script>
  
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.12.2/+esm'

function getMermaidConfigFromTheme() {
  const styles = getComputedStyle(document.documentElement);
  const cssVar = (name, fallback) => styles.getPropertyValue(name).trim() || fallback;

  const backgroundPrimary = cssVar("--bg-primary", "#1b1b1f");
  const backgroundSecondary = cssVar("--bg-secondary", "#09090a");

  const blue = cssVar("--blue", "#5cb8ff");
  const red = cssVar("--red", "#ff7070");
  const green = cssVar("--green", "#4ade5e");

  const fontMono = cssVar("--font-mono", "JetBrains Mono, SF Mono, Consolas, monospace");

  return {
    theme: "base",
    themeVariables: {
      darkMode: true,
      fontFamily: fontMono,
      fontSize: "14px",
      background: backgroundPrimary,

      primaryColor: blue,
      primaryTextColor: "#000",

      lineColor: red,
      textColor: green,
      edgeLabelBackground: backgroundSecondary,
      titleColor: green,
    },

    themeCSS: `
      /* Nodes (flowchart + generic) */
      .node rect, .node polygon, .node circle, .node path {
        fill: ${blue} !important;
        stroke: ${blue} !important;
        stroke-width: 2px !important;
      }
      .node text, .node tspan {
        fill: #000 !important;
      }

      /* State diagram nodes */
      .statediagram-state rect, .stateGroup rect {
        fill: ${blue} !important;
        stroke: ${blue} !important;
        stroke-width: 2px !important;
      }
      .statediagram-state text, .statediagram-state tspan,
      .stateGroup text, .stateGroup tspan {
        fill: #000 !important;
      }

      /* Arrows / edges */
      .edgePath path {
        stroke: ${red} !important;
        stroke-width: 1.75px !important;
      }
      marker path {
        stroke: ${red} !important;
        fill: ${red} !important;
      }

      /* Edge labels (arrow text) */
      .edgeLabel rect {
        fill: ${backgroundSecondary} !important;
        stroke: ${red} !important;
        stroke-width: 1px !important;
      }
      .edgeLabel text, .edgeLabel tspan,
      .edgeLabel span, .edgeLabel p,
      .edgeLabel foreignObject *,
      .label text, .label tspan {
        fill: ${green} !important;
        color: ${green} !important;
      }
    `,
  };
}

    function renderAllMermaid() {
      const mermaidConfig = getMermaidConfigFromTheme();
      mermaid.initialize({
        startOnLoad: true,
        ...mermaidConfig,
      });
      mermaid.run({ querySelector: ".mermaid" });
      document.querySelectorAll('pre.mermaid, .mermaid').forEach(block => {
        mermaid.run({ nodes: [block] });
      });
    }
    renderAllMermaid();
    
    const observer = new MutationObserver(() => {
      renderAllMermaid();
    });
    observer.observe(document.body, { childList: true, subtree: true });
  </script>
  
</footer>
</body>
</html>

